<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <title>Client Management</title>
    <th:block th:replace="~{fragment/general :: headerfiles}" />
    <script>
        function onChangeSecret() {
            const newSecret = prompt("Enter new secret");
            if (newSecret) {
                document.getElementById("secretUpdate").value = newSecret;
                document.getElementById("secretForm").submit();
            }
        }
        function confirmDelete(id) {
            const deleteForm = document.getElementById("deleteForm" + id);
            const agree = confirm("Are you sure that you want to delete this client?");
            if (agree) {
                deleteForm.submit();
            }
        }
    </script>
</head>
<body>
<div class="container">
    <header th:insert="~{fragment/general :: header}"> </header>
    <div><h4>Client List</h4></div>
    <div class="d-flex w-100 justify-content-end">
        <a class="btn btn-primary my-2" th:href="@{/client/create}">
            <i class="bi bi-plus"></i> Create new</a>
    </div>
    <div th:replace="~{fragment/general :: message}"></div>
    <table class="table table-striped table-bordered table-responsive">
        <thead class="thead-dark">
        <tr>
            <th style="width: 2%;">#</th>
            <th style="width: 10%;">Client ID</th>
            <th style="width: 10%;">Encoded secret</th>
            <th style="width: 5%;">Resource IDs</th>
            <th style="width: 5%;">Scopes</th>
            <th style="width: 5%;">Auto approve scopes</th>
            <th style="width: 10%;">Grant Types</th>
            <th style="width: 10%;">Authorities</th>
            <th style="width: 20%;">Redirect URIs</th>
            <th style="width: 5%;">Access Token Validity (Second)</th>
            <th style="width: 5%;">Refresh Token Validity (Second)</th>
            <th style="width: 10%;"></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="client, iter: ${clientList}">
            <td><span th:text="${iter.index + 1}"></span></td>
            <td><span th:text="${client.clientId}"></span></td>
            <td class="text-break"><span th:text="${client.clientSecret}"></span>
                <span style="color: red" th:if="${client.secretRequired}" th:text="${'(*)'}"></span>
                <button class="btn btn-sm btn-warning" onclick="onChangeSecret()">
                    <i class="bi bi-pencil-square" style="font-size: 1rem;"></i>
                </button>
                <form id="secretForm" th:action="@{'/client/update-secret/' + ${client.clientId}}" th:method="POST">
                    <label><input type="hidden" id="secretUpdate" th:name="newSecret"></label>
                </form>
            </td>
            <td><span th:if="${client.resourceIds}" th:text="${#strings.setJoin(client.resourceIds,', ')}"></span></td>
            <td><th:block th:if="${client.scoped}" >
                <span th:text="${#strings.setJoin(client.scope,', ')}"></span></th:block></td>
            <td><span th:if="${client.autoApproveScopes}" th:text="${#strings.setJoin(client.autoApproveScopes,', ')}"></span></td>
            <td><span th:if="${client.authorizedGrantTypes}" th:text="${#strings.setJoin(client.authorizedGrantTypes,', ')}"></span></td>
            <td><span th:if="${client.authorities}" th:text="${#strings.setJoin(client.authorities,', ')}"></span></td>
            <td><span th:if="${client.registeredRedirectUri}" th:text="${#strings.setJoin(client.registeredRedirectUri,', ')}"></span></td>
            <td><span th:text="${client.accessTokenValiditySeconds}"></span></td>
            <td><span th:text="${client.refreshTokenValiditySeconds}"></span></td>
            <td>
                <a th:href="@{'/client/update/' + ${client.clientId}}" class="btn btn-sm btn-warning d-inline-block">
                    <i class="bi bi-pencil-fill"></i></a>
                <form th:id="deleteForm + ${client.clientId}" class="d-inline-block" th:action="@{/client/delete}" th:method="POST">
                    <label><input type="hidden" th:name="id" th:value="${client.clientId}"></label>
                    <button type="button" th:data-thing="${client.clientId}" onclick="confirmDelete(this.getAttribute('data-thing'));"
                            class="btn btn-sm btn-danger">
                        <i class="bi bi-trash-fill"></i></button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
    <div th:replace="~{fragment/general :: footer}"></div>
</div>
</body>
</html>